<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../styles/buttons-style.html">

<dom-module id="ht-regimen-item">
    <template>

        <style include="buttons-style">

            .base {
                background: rgba(0,0,0,.1);
            }

            .normal {
                width: 90px;
                margin-left: auto;
                margin-right: auto;
            }

            .normal_input {
                width: 86px;
                margin-left: auto;
                margin-right: auto;
            }

            .small {
                width: 30px;
            }

            .small_input {
                width: 26px;
            }

            .positive {
                background: var(--app-secondary-color);
                color: white;
            }

            paper-button {
                width: 100%;
            }

            .button {
                border-radius: 0px;
            }

        </style>

<!--        <div id="container" class$="base [[custom]]">-->
<!--            <paper-input id="input" class="[[custom]]_input" no-label-float value="{{quantity}}" type="number" min="0" on-change="_selectQuantity"></paper-input>-->
<!--        </div>-->
<!--        <div id="container" class$="base [[custom]]">{{quantity}}</div>-->
        <paper-button id="counter" class$="button [[custom]]">{{quantity}}</paper-button>
<!--        <div>-->
<!--            <paper-button id="counter" class$="button [[custom]]">{{quantity}}</paper-button>-->
<!--            <paper-icon-button icon="icons:close"></paper-icon-button>-->
<!--        </div>-->
<!--        <paper-button id="counter" class$="button button&#45;&#45;menu" on-tap="_toggleAddActions">-->
<!--            <span class="no-mobile">{{quantity}}</span>-->
<!--            <iron-icon icon="icons:close" ></iron-icon>-->
<!--        </paper-button>-->


    </template>
    <script>

        class HtRegimenItem extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-regimen-item';
            }

            static get properties() {
                return {
                    api: {
                        type: Object
                    },
                    user: {
                        type: Object
                    },
                    custom: {
                        type: String,
                        value: 'normal'
                    },
                    quantity: {
                        type: Number,
                        notify: true
                    },
                    mouseIsDown: {
                        type: Boolean,
                        value: false
                    },
                    resetTimer: {
                        type: Object,
                        value: null
                    }
                };
            }

            static get observers() {
                return [
                    "_quantityChanged(quantity)"
                ];
            }

            constructor() {
                super();
            }

            ready() {
                super.ready();
                const counter = this.$['counter'];
                if (!counter) return;
                counter.addEventListener('mousedown', this.mouseDown.bind(this), false);
                counter.addEventListener('mouseup', this.mouseUp.bind(this), false);
            }

            reset() {
                if (this.mouseIsDown) {
                    this.set("quantity", "");
                    this.mouseIsDown = false;
                }
            }

            mouseDown(e) {
                console.log("mouseDown");
                if (this.resetTimer) {
                    clearTimeout(this.resetTimer);
                    this.resetTimer = null;
                }
                if (!this.mouseIsDown) {
                    this.mouseIsDown = true;
                    this.resetTimer = setTimeout(this.reset.bind(this), 500);
                }
            }

            mouseUp(e) {
                console.log("mouseUp");
                if (this.mouseIsDown) {
                    if (this.quantity === "") {
                        this.quantity = 0;
                    }
                    this.set("quantity", this.quantity + 1);
                    this.mouseIsDown = false;
                }
            }

            setQuantity(quantity) {
                // this.set("quantity", quantity);
            }

            _selectQuantity(event) {
                console.log("_selectQuantity: " + this.quantity);
                this.dispatchEvent(new CustomEvent('quantity-changed', {
                    detail: {
                        quantity: this.quantity
                    }, bubbles: true
                }));
            }

            _quantityChanged() {
                console.log("_quantityChanged: " + this.quantity);
                if (this.quantity) {
                    this.set("custom", "button--save");
                }
                else {
                    this.set("custom", "");
                }
            }
        }

        customElements.define(HtRegimenItem.is, HtRegimenItem);
    </script>
</dom-module>
