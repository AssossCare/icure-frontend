<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../styles/buttons-style.html">
<link rel="import" href="../../styles/paper-input-style.html">

<dom-module id="ht-regimen-item">
    <template>

        <style include="dialog-style buttons-style">

            .base {
                background: rgba(0,0,0,.1);
            }

            .normal {
                width: 90px;
                margin-left: auto;
                margin-right: auto;
            }

            .normal_input {
                width: 86px;
                margin-left: auto;
                margin-right: auto;
            }

            .small {
                width: 30px;
            }

            .small_input {
                width: 26px;
            }

            #container {
                width: var(--div-counter-width);
                height: var(--div-counter-height);
                font-size: var(--div-counter-font-size);
                text-align: center;
                -webkit-user-select: none;
            }

            .positive {
                background: var(--app-secondary-color);
                color: white;
            }
        </style>

<!--        <div id="container" class$="base [[custom]]">-->
<!--            <paper-input id="input" class="[[custom]]_input" no-label-float value="{{quantity}}" type="number" min="0" on-change="_selectQuantity"></paper-input>-->
<!--        </div>-->
        <div id="container" class$="base [[custom]]">{{quantity}}</div>

    </template>
    <script>

        class HtRegimenItem extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-regimen-item';
            }

            static get properties() {
                return {
                    api: {
                        type: Object
                    },
                    user: {
                        type: Object
                    },
                    custom: {
                        type: String,
                        value: 'normal'
                    },
                    quantity: {
                        type: Number,
                        notify: true
                    }
                };
            }

            static get observers() {
                return [
                    "_quantityChanged(quantity)"
                ];
            }

            constructor() {
                super();
            }

            ready() {
                super.ready();
                const container = this.$['container'];
                if (!container) return;
                container.addEventListener('click', this.clickAdd.bind(this), false);
                container.addEventListener('contextmenu', this.clickAdd.bind(this), false);

            }

            clickAdd(e) {
                if (e.button === 0) {
                    console.log("add");
                    this.set("quantity", this.quantity + 1);
               } else if (e.button === 2) {
                    if (this.quantity < 1) return;
                    console.log("remove");
                    this.set("quantity", this.quantity - 1)
                }
                e.preventDefault();
                return false;
            }

            setQuantity(quantity) {
                this.set("quantity", quantity);
                this._refresh();
            }

            _selectQuantity(event) {
                console.log("_selectQuantity: " + this.quantity);
                this.dispatchEvent(new CustomEvent('quantity-changed', {
                    detail: {
                        quantity: this.quantity
                    }, bubbles: true
                }));
            }

            _quantityChanged() {
                console.log("_quantityChanged: " + this.quantity);
                this._refresh();
            }

            _refresh() {
                console.log("refresh:" + this.quantity);
                if (this.quantity > 0) {
                    // this.$["container"].classList.add("positive");
                    this.set("custom", "positive");
                }
                else {
                    this.set("custom", "");
                    // this.$["container"].classList.remove("positive");
                }
            }
        }

        customElements.define(HtRegimenItem.is, HtRegimenItem);
    </script>
</dom-module>
