<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../styles/buttons-style.html">
<link rel="import" href="../../styles/paper-input-style.html">

<dom-module id="ht-regimen">
    <template>

        <style include="dialog-style buttons-style">
            .extra {
                display: flex;
                flex-direction: row;
            }

            .destination-tag {
                background: rgba(0,0,0,.1);
                color: var(--exm-token-input-badge-text-color,--text-primary-color);
                height: 24px;
                min-height: 1px;
                font-size: 12px;
                min-width: initial;
                padding: 0;
                margin: 5px 10px 0 0;
                border-radius: 5px;
                overflow: hidden;
                float:left;
            }

            .destination-type{
                background: var(--app-secondary-color);
                color: var(--app-text-color);
                display: flex;
                height: 100%;
                flex-flow: row wrap;
                padding: 0 4px;
                box-sizing: border-box;
                align-items: center;
                margin-right: 8px;
            }

            .del-destination {
                height: 22px;
                width: 22px;
                margin: 0 4px 0 8px;
                padding: 2px;
            }
        </style>

        <!--
        <div id="container" class="extra">
            <span>[[extra.quantity]] prise(s) Ã  [[time]]</span>
            <paper-icon-button icon="icons:close" on-tap="_delete">
            </paper-icon-button>
        </div>
        -->

        <paper-item class="destination-tag">
            <div class="destination-type">[[time]]</div>
            <div class="one-line-menu list-title" on-tap="_increase">[[extra.quantity]] prise(s)</div>
            <paper-icon-button class="del-destination" icon="icons:delete" id="[[singleRecipient.displayName]]" on-tap="_delete"></paper-icon-button>
        </paper-item>

    </template>
    <script>

        class HtRegimen extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-regimen';
            }

            static get properties() {
                return {
                    api: {
                        type: Object
                    },
                    user: {
                        type: Object
                    },
                    time: {
                        type: String
                    },
                    extra: {
                        type: Object,
                        value: () => {}
                    }
                };
            }

            static get observers() {
                return ["_extraChanged(extra)"];
            }

            constructor() {
                super();
            }

            ready() {
                super.ready();
            }

            refresh() {
                console.log("refresh " + this.extra.code);
                this.notifyPath("extra.quantity");
            }

            _increase() {
                this.extra.quantity++;
                this.notifyPath("extra.quantity")
            }

            _delete() {
                this.dispatchEvent(new CustomEvent("delete-extra", {
                    detail: {
                        extra: this.extra
                    },
                    bubbles: true
                }));
            }

            _extraChanged() {
                console.log("extraChanged");
                this.set("time",
                    (Math.floor(this.extra.code / 10000) % 100).toString().padStart(2, '0') + ":" +
                    (Math.floor(this.extra.code / 100) % 100).toString().padStart(2, '0'));
            }
        }

        customElements.define(HtRegimen.is, HtRegimen);
    </script>
</dom-module>
