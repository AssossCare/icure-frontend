<link rel="import" href="../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../styles/shared-styles.html">
<link rel="import" href="../../styles/buttons-style.html">
<link rel="import" href="../../styles/paper-input-style.html">

<dom-module id="ht-regimen">
    <template>

        <style include="dialog-style buttons-style">
            .dose-tag {
                box-sizing: border-box;
                background: var(--app-input-background-color);
                color: var(--app-text-color-dark);
                height: 28px;
                font-weight: 500;
                text-align: center;
                font-size: var(--font-size-normal);
                min-width: initial;
                padding: 0;
                margin-right: 8px;
                border-radius: 4px;
                border-width: 0;
                border-style: solid;
                overflow: hidden;
                float: left;
                display: flex;
                line-height: 28px;
            }

            .increase-button {
                height: 100%;
            }

            .time-label {
                padding: 0 16px;
                margin: 0;
            }

            .quantity-label {
                background: var(--app-secondary-color);
                color: var(--app-text-color-light);
                padding: 0 16px;
                margin: 0;
                border-right-width: 1px;
                border-right-style: solid;
                border-right-color: var(--app-secondary-color-dark);
            }
            .quantity-label:hover {
                background: var(--app-secondary-color-dark);
            }

            .quantity-label:focus {
                background: var(--app-secondary-color-dark);
                color: #fafafa;
            }

            .decrease-button {
                --paper-icon-button: {
                    height: 28px;
                    width: 28px;
                    background: var(--app-secondary-color);
                    color: var(--app-text-color-light);
                    padding: 4px;
                };
            }

            .decrease-button:hover {
                background: var(--app-secondary-color-dark);

            }
            .decrease-button:focus {
                background: var(--app-secondary-color-dark);
                color: #fafafa;
            }

            /*.decrease-button:hover {*/
            /*    --paper-icon-button: {*/
            /*        background: var(--app-text-color-light);*/
            /*        color: var(--app-secondary-color);*/
            /*    }*/
            /*}*/
            /*.decrease-button:focus {*/
            /*    --paper-icon-button: {*/
            /*        background: #fafafa;*/
            /*    }*/
            /*}*/
        </style>

        <!--
        <div id="container" class="extra">
            <span>[[extra.quantity]] prise(s) à [[time]]</span>
            <paper-icon-button icon="icons:close" on-tap="_delete">
            </paper-icon-button>
        </div>
        -->

        <div class="dose-tag">
            <div class="time-label">[[time]]</div>
            <div class="quantity-label" on-tap="_increase">[[extra.quantity]]</div>
            <paper-icon-button class="decrease-button" icon="icons:remove" id="[[singleRecipient.displayName]]" on-tap="_decrease"></paper-icon-button>
        </div>

    </template>
    <script>

        class HtRegimen extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-regimen';
            }

            static get properties() {
                return {
                    api: {
                        type: Object
                    },
                    user: {
                        type: Object
                    },
                    time: {
                        type: String
                    },
                    extra: {
                        type: Object,
                        value: () => {}
                    },
                    unit: {
                        type: String
                    },
                    quantityFactor: {
                        type: Object,
                        notify: true,
                        value: null
                    }

                };
            }

            static get observers() {
                return [
                    "_extraChanged(extra)"
                ];
            }

            constructor() {
                super();
                this.unit = this.localize("uni", "Unités");
            }

            ready() {
                super.ready();
            }

            // refresh() {
            //     console.log("refresh " + this.extra.code);
            //     this.notifyPath("extra.quantity");
            // }

            _increase() {
                if (this.quantityFactor && this.quantityFactor.denominator > 1) {
                    this.set("extra.quantity", this.quantityFactor.numLabel);
                } else {
                    const quantityValue = parseInt(this.extra.quantity) || 0;
                    this.set("extra.quantity", quantityValue + 1);
                }
            }

            _decrease() {
                if (this.quantityFactor && this.quantityFactor.denominator > 1) {
                    this.set("extra.quantity", 0);
                } else {
                    const quantityValue = parseInt(this.extra.quantity) || 0;
                    if (quantityValue > 0) {
                        this.set("extra.quantity", quantityValue - 1);
                    }
                }
            }

            // _delete() {
            //     this.dispatchEvent(new CustomEvent("delete-extra", {
            //         detail: {extra: this.extra},
            //         bubbles: true
            //     }));
            // }

            _extraChanged() {
                console.log("extraChanged");
                this.set("time",
                    (Math.floor(this.extra.code / 10000) % 100).toString().padStart(2, '0') + ":" +
                    (Math.floor(this.extra.code / 100) % 100).toString().padStart(2, '0'));
            }
        }

        customElements.define(HtRegimen.is, HtRegimen);
    </script>
</dom-module>
