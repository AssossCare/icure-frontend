<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-text-field.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../../../../bower_components/vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../../../../../bower_components/vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../../bower_components/paper-styles/shadow.html">
<link rel="import" href="../../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../dynamic-form/dynamic-link.html">
<link rel="import" href="../../../dynamic-form/dynamic-pills.html">
<link rel="import" href="../../../ht-spinner/ht-spinner.html">
<link rel="import" href="../../../dynamic-form/dynamic-doc.html">
<link rel="import" href="../../../collapse-button/collapse-button.html">
<link rel="import" href="../../../../styles/dialog-style.html">
<link rel="import" href="../../../../styles/scrollbar-style.html">
<link rel="import" href="../../../../styles/buttons-style.html">
<link rel="import" href="../../../../styles/notification-style.html">
<link rel="import" href="../../../../styles/spinner-style.html">
<link rel="import" href="../../../../styles/shared-styles.html">
<link rel="import" href="../../../../styles/paper-tabs-style.html">

<dom-module id="ht-pat-care-path-detail-procedure">
    <template>
        <style include="dialog-style scrollbar-style buttons-style notification-style spinner-style shared-styles paper-tabs-style">

            .btn-dropdown-container paper-button{
                display: flex;
                flex-flow: row nowrap;
                justify-content: flex-start;
                align-items: center;
                text-transform: capitalize;
                height: 28px;
                padding: 0 12px 0 8px;
                font-weight: 400;
                font-size: var(--font-size-normal);
                text-align: left;
                white-space: nowrap;
                text-overflow: ellipsis;
                overflow: hidden;
                flex-grow: 1;
                border-radius: 0;
                margin: 0;
            }

            .btn-dropdown-container paper-icon-button:hover{
                background: var(--app-background-color-dark);
            }

            .btn-dropdown-container paper-button iron-icon{
                color: var(--app-secondary-color);
                height: 20px;
                width: 20px;
                margin-right: 4px;
                box-sizing: border-box;
            }

            .w50{
                width: 50%;
                padding: 4px;
            }

            .w100{
                width: 98%;
                padding: 4px;
            }

            .ko{
                color: var(--app-status-color-nok)
            }

            .ok{
                color: var(--app-status-color-ok)
            }

            .p4{
                padding: 4px;
            }


            .menu-item {
                @apply --padding-menu-item;
                height: 24px;
                min-height: 24px;
                font-size: var(--font-size-normal);
                text-transform: inherit;
                justify-content: space-between;
                cursor: pointer;
                @apply --transition;
            }

            .sublist .menu-item {
                font-size: var(--font-size-normal);
                min-height:20px;
                height:20px;
            }

            .menu-item:hover{
                background: var(--app-dark-color-faded);
                @apply --transition;
            }

            .menu-item .iron-selected{
                background:var(--app-primary-color);

            }

            .one-line-menu {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                font-weight: 400;
                padding-left:0;
            }

            collapse-button[opened] .menu-item-icon{
                transform: scaleY(-1);
            }

            .sublist-procedure{
                background:var(--app-light-color);
                margin:0 0 0 0px;
                padding:0;
            }

            .table-line-menu {
                display: flex;
                flex-flow: row nowrap;
                justify-content: space-between;
                align-items: center;
                height: 100%;
                width: 100%;
            }

            .table-line-menu-top{
                padding-left: var(--padding-menu-item_-_padding-left);
                padding-right: var(--padding-menu-item_-_padding-right);
                box-sizing: border-box;
            }

            .table-line-menu div:not(:last-child){
                border-right: 1px solid var(--app-background-color-dark);
                height: 20px;
                line-height: 20px;
            }

            .one-line-menu {
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                font-weight: 400;
                padding-left:0;
            }

            .menu-item paper-icon-button.menu-item-icon--add, .list-info paper-icon-button.menu-item-icon {
                padding: 0px;
                height: 18px;
                width: 18px;
                border-radius: 3px;
                background: var(--app-secondary-color);
                color: var(--app-text-color-light);
                margin-right: 8px;
            }

            .w10{
                width: 9%;
            }
            .w20{
                width: 19%;
            }
            .w30{
                width: 29%;
            }
            .w40{
                width: 39%;
            }
            .w50{
                width: 49%;
            }
            .w60{
                width: 59%;
            }
            .w70{
                width: 69%;
            }
            .w80{
                width: 79%;
            }
            .w90{
                width: 89%;
            }
            .w100{
                width: 99%;
            }
            .m4{
                margin: 4px;
            }
            .p4{
                padding: 4px;
            }
            .mw30{
                min-width: 29%;
            }

            .procDetailDialog{
                display: flex;
                height: 100%;
                width: auto;
                margin: 0;
                padding: 0;
            }

            .proc-menu-list{
                height: 100%;
                width: 30%;
                background-color: var(--app-background-color-dark);
                border-right: 1px solid var(--app-background-color-dark);
                overflow: auto;
                position: relative;
            }

            .proc-menu-view{
                height: 100%;
                width: 70%;
                position: relative;
                background: white;
            }

            .table-line-menu .date{
                width: 14%;
                padding-right: 4px;
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
            }


            .table-line-menu .name{
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                padding-left: 4px;
                padding-right: 4px;
                width: 64%
            }

            .table-line-menu .status{
                overflow: hidden;
                text-overflow: ellipsis;
                white-space: nowrap;
                padding-left: 4px;
                padding-right: 4px;
                width: 20%
            }

            .table-line-menu .dateTit{
                width: 14%;
                padding-right: 10px;
            }


            .table-line-menu .nameTit{
                padding-left:4px;
                padding-right:4px;
                width: 64%;
            }

            .table-line-menu .statusTit{
                padding-left:4px;
                padding-right:4px;
                width: 20%;
            }

            iron-pages{
                height: calc(100% - 50px);
            }

            .proc-btn{
                justify-content: center;
                height: 40px;
                width: auto;
                display: flex;
                align-items: center;
            }

            .proc-submenu-container{
                height: calc(100% - 50px);
            }

            .new-proc-view{
                height: 100%;
                width: auto;
            }

            .new-proc-view-list-container{
                width: 30%;
            }

            .new-proc-view-form-container{

            }

        </style>

        <div class="procDetailDialog">
            <div class="proc-menu-list">
                <div class="proc-submenu-container">
                    <ht-spinner active="[[isLoading]]"></ht-spinner>
                    <div class="proc-container">
                        <div class="proc-container-title">
                            [[localize('care-path-linked-proc', 'Linked procedures', language)]]
                        </div>
                        <div class="proc-container-list">
                            <paper-listbox id="" class="menu-content sublist-procedure" selectable="paper-item"  toggle-shift>
                                <div class="table-line-menu table-line-menu-top">
                                    <div class="dateTit">[[localize('dat','Date',language)]]</div>
                                    <div class="nameTit">[[localize('name','Name',language)]]</div>
                                    <div class="statusTit">[[localize('sta','Status',language)]]</div>
                                </div>
                                <template is="dom-repeat" items="[[]]" as="proc" id="linkedProcList">
                                    <collapse-button>
                                        <paper-item slot="sublist-collapse-item" id$="[[proc.id]]" data-item$="[[proc]]" aria-selected="[[selected]]" class$="menu-trigger menu-item [[isIronSelected(selected)]]" on-tap="_showProcedure">
                                            <div id="subMenu-linked-proc" class="table-line-menu">
                                                <div class="date">[[_formatDate(proc.created)]]</div>
                                                <div class="name">[[proc.name]]</div>
                                                <div class="status">[[proc.name]]</div>
                                            </div>
                                        </paper-item>
                                    </collapse-button>
                                </template>
                            </paper-listbox>
                        </div>
                    </div>
                </div>
                <div class="proc-btn">
                    <paper-button on-tap="_showNewProcDialog" class="button button--save"><iron-icon icon="vaadin:plus-circle-o"></iron-icon>[[localize('care-path-add-procedure', 'Add procedure', language)]]</paper-button>
                </div>
                <ht-spinner active="[[isLoading]]"></ht-spinner>
            </div>
            <div class="proc-menu-view">
                <template is="dom-if" if="[[_isSelectedProcedure(selectedProcedure, selectedProcedure.*)]]">
                    <div class="proc-preview">

                    </div>
                </template>
                <template is="dom-if" if="[[newProcedureView]]">
                    <div class="new-proc-view">
                       <div class="new-proc-view-list-container">

                       </div>
                       <div class="new-proc-view-form-container">

                       </div>
                    </div>
                </template>
            </div>
        </div>

    </template>
    <script>
        import * as models from 'icc-api/dist/icc-api/model/models';
        import moment from 'moment/src/moment';
        import juicy from 'juicy-html'
        import mustache from "mustache/mustache.js";
        import Chart from 'chart.js';

        class HtPatCarePathDetailProcedure extends Polymer.TkLocalizerMixin(Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element)) {

            static get is() {
                return 'ht-pat-care-path-detail-procedure';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    currentContact:{
                        type: Object,
                        value: () => {}
                    },
                    hcp:{
                        type: Object,
                        value: () => {}
                    },
                    patient:{
                        type: Object,
                        value: () => {}
                    },
                    selectedCarePath:{
                        type: Object,
                        value: () => {}
                    },
                    isLoading:{
                        type: Boolean,
                        value: false
                    },
                    newProcedureView:{
                        type: Boolean,
                        value: false
                    },
                    selectedCarePathType:{
                        type: Object,
                        value: {}
                    },
                    availablePackageOfProcedure:{
                        type: Array,
                        value: []
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }

            _showNewProcDialog(){
                this.set('newProcedureView', true)
            }

            _getListOfProcedures(type){
                return _.get(_.get(this, 'availablePackageOfProcedure', []).find(pack => pack.code === type), 'linkedProcedure', [])
            }

            _getDescription(proc){
                return _.get(proc, "code", null)+" - "+_.get(proc, "label."+this.language, null)
            }

        }
        customElements.define(HtPatCarePathDetailProcedure.is, HtPatCarePathDetailProcedure);
    </script>
</dom-module>
