<link rel="import" href="../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../bower_components/paper-item/paper-item.html">

<link rel="import" href="../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="../../../styles/dialog-style.html">
<link rel="import" href="../../../styles/scrollbar-style.html">
<link rel="import" href="../../../styles/paper-tabs-style.html">

<link rel="import" href="./vaccine/ht-pat-vaccine-history.html">
<link rel="import" href="./vaccine/ht-pat-vaccine-schema-wallonia.html">
<link rel="import" href="./vaccine/ht-pat-vaccine-schema-flanders.html">
<link rel="import" href="./ht-pat-vaccine-product-dialog.html">

<dom-module id="ht-pat-vaccine-schema-dialog">
    <template>
        <style include="scrollbar-style dialog-style paper-tabs-style">
            #vaccineSchemaDialog{
                height: calc(98% - 12vh);
                width: 98%;
                max-height: calc(100% - 64px - 48px - 20px); /* 100% - header - margin - footer*/
                min-height: 400px;
                min-width: 800px;
                top: 64px;
            }

            .buttons{
                position: absolute;
                right: 0;
                bottom: 0;
                margin: 0;
            }

            .content{
                max-height: 100%;
            }

        </style>

        <paper-dialog id="vaccineSchemaDialog">
            <div class="content">
                <paper-tabs class="tab-selector" selected="{{tabs}}" >
                    <paper-tab>
                        <iron-icon class="tabIcon" icon="vaadin:time-backward"></iron-icon> [[localize('vac-sch-histo','Vaccination history',language)]]
                    </paper-tab>
                    <paper-tab>
                        <iron-icon class="tabIcon" icon="vaadin:child"></iron-icon> [[localize('cd-transaction-vaccinationscheme','Vaccination schema (French community)',language)]]
                    </paper-tab>
                    <paper-tab>
                        <iron-icon class="tabIcon" icon="vaadin:child"></iron-icon> [[localize('cd-transaction-vaccinationscheme','Vaccination schema (Flanders)',language)]]
                    </paper-tab>
                    <!--<paper-tab>[[localize('json_vwr','JSON View',language)]]</paper-tab>-->
                </paper-tabs>
                <iron-pages selected="[[tabs]]">
                    <page>
                        <ht-pat-vaccine-history id="history" api="[[api]]" user="[[user]]" patient="[[patient]]" resources="[[resources]]" language="[[language]]" i18n="[[i18n]]" contacts="[[contacts]]"></ht-pat-vaccine-history>
                    </page>
                    <page>
                        <ht-pat-vaccine-schema-wallonia id="wallonia" region="fr" api="[[api]]" user="[[user]]" patient="[[patient]]" resources="[[resources]]" language="[[language]]" i18n="[[i18n]]" contacts="[[contacts]]" on-select-product="_onSelectProduct"></ht-pat-vaccine-schema-wallonia>
                    </page>
                    <page>
                        <ht-pat-vaccine-schema-wallonia id="flanders" region="nl" api="[[api]]" user="[[user]]" patient="[[patient]]" resources="[[resources]]" language="[[language]]" i18n="[[i18n]]" contacts="[[contacts]]" on-select-product="_onSelectProduct"></ht-pat-vaccine-schema-wallonia>
                        <!--
                        <ht-pat-vaccine-schema-flanders id="flanders" api="[[api]]" user="[[user]]" patient="[[patient]]" esources="[[resources]]" language="[[language]]" i18n="[[i18n]]" contacts="[[contacts]]"></ht-pat-vaccine-schema-flanders>
                        -->
                    </page>
                </iron-pages>
            </div>
            <div class="buttons">
                <paper-button class="button button--save" on-tap="_createMedicationSchema"><iron-icon icon="icons:save" class="mr5 smallIcon" ></iron-icon> [[localize('save','Save',language)]]</paper-button>
                <paper-button class="button button--other" on-tap="_print"><iron-icon icon="vaadin:print" class="mr5 smallIcon"></iron-icon> [[localize('print','Print',language)]]</paper-button>
                <paper-button class="button" on-tap="_close"><iron-icon icon="icons:close" class="mr5 smallIcon"></iron-icon> [[localize('clo','Close',language)]]</paper-button>
            </div>
        </paper-dialog>

        <ht-pat-vaccine-product-dialog id="vaccineProductDialog" api="[[api]]" user="[[user]]" resources="[[resources]]" language="[[language]]" i18n="[[i18n]]" on-product-selected="_onProductSelected"></ht-pat-vaccine-product-dialog>

    </template>
    <script>
        import _ from 'lodash/lodash';

        class HtPatVaccineShemaDialog extends Polymer.TkLocalizerMixin(Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element)) {
            static get is() {
                return 'ht-pat-vaccine-schema-dialog';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    tabs:{
                        type: Number,
                        value: 0
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }

            _openDialog(){
                this.$['vaccineSchemaDialog'].open();
                this.$['wallonia'].initialize();
                //this.$['flanders'].initialize();
            }

            _onSelectProduct(e) {
                console.log("onSelectProduct2");
                this.$['vaccineProductDialog'].openDialog(e.detail);
            }

            _onProductSelected(e) {
                this.$['wallonia'].selectProduct(e.detail);
            }

            _createMedicationSchema() {
                this.$['wallonia'].createMedicationSchema();
            }

            _close(){
                this.$['vaccineSchemaDialog'].close()
            }

            _print() {
                const html = this.$['wallonia'].print();
                this.api.pdfReport(this._getHtml(html), {type:"unknown",completionEvent:"pdfDoneRenderingEvent"})
                .then(printedPdf => !printedPdf.printed && this.api.triggerFileDownload(printedPdf.pdf, "application/pdf", "vaccine.pdf" ))
                .finally(() => {
                })
            }

            _getHtml(body) {
                return `
                    <html>
                        <head>
                            <link href="https://fonts.googleapis.com/css?family=Open+Sans" rel="stylesheet">
                            <style>

                                @page {size: A4 landscape; width: 210mm; height: 297mm; margin: 0; padding: 0; }
                                body {margin: 0; padding: 0; font-family: /* "Open Sans", */ Arial, Helvetica, sans-serif; line-height:1.3em; }
                                .page { width: 300mm; color:#000000; font-size:12px; padding:10mm; position:relative; /* border:1px solid #f00; */ }

                                h1 { font-size:17px; margin:0; padding:0; }
                                h2 { font-size:15px; font-weight:400; font-style: italic; text-align: center; padding:0; margin:0; }
                                p { margin:0 0 10px 0; padding:0; }

                                .m0auto { margin:0 auto }

                                .m0 { margin:0px } .m1 { margin:1px } .m2 { margin:2px } .m3 { margin:3px } .m4 { margin:4px } .m5 { margin:5px } .m6 { margin:6px } .m7 { margin:7px } .m8 { margin:8px } .m9 { margin:9px } .m10 { margin:10px } .m15 { margin:15px } .m20 { margin:20px } .m25 { margin:25px } .m30 { margin:30px } .m35 { margin:35px } .m40 { margin:40px } .m45 { margin:45px } .m50 { margin:50px }
                                .mt0 { margin-top:0px } .mt1 { margin-top:1px } .mt2 { margin-top:2px } .mt3 { margin-top:3px } .mt4 { margin-top:4px } .mt5 { margin-top:5px } .mt6 { margin-top:6px } .mt7 { margin-top:7px } .mt8 { margin-top:8px } .mt9 { margin-top:9px } .mt10 { margin-top:10px } .mt15 { margin-top:15px } .mt20 { margin-top:20px } .mt25 { margin-top:25px } .mt30 { margin-top:30px } .mt35 { margin-top:35px } .mt40 { margin-top:40px } .mt45 { margin-top:45px } .mt50 { margin-top:50px }
                                .mr0 { margin-right:0px } .mr1 { margin-right:1px } .mr2 { margin-right:2px } .mr3 { margin-right:3px } .mr4 { margin-right:4px } .mr5 { margin-right:5px } .mr6 { margin-right:6px } .mr7 { margin-right:7px } .mr8 { margin-right:8px } .mr9 { margin-right:9px } .mr10 { margin-right:10px } .mr15 { margin-right:15px } .mr20 { margin-right:20px } .mr25 { margin-right:25px } .mr30 { margin-right:30px } .mr35 { margin-right:35px } .mr40 { margin-right:40px } .mr45 { margin-right:45px } .mr50 { margin-right:50px }
                                .mb0 { margin-bottom:0px } .mb1 { margin-bottom:1px } .mb2 { margin-bottom:2px } .mb3 { margin-bottom:3px } .mb4 { margin-bottom:4px } .mb5 { margin-bottom:5px } .mb6 { margin-bottom:6px } .mb7 { margin-bottom:7px } .mb8 { margin-bottom:8px } .mb9 { margin-bottom:9px } .mb10 { margin-bottom:10px } .mb15 { margin-bottom:15px } .mb20 { margin-bottom:20px } .mb25 { margin-bottom:25px } .mb30 { margin-bottom:30px } .mb35 { margin-bottom:35px } .mb40 { margin-bottom:40px } .mb45 { margin-bottom:45px } .mb50 { margin-bottom:50px }
                                .ml0 { margin-left:0px } .ml1 { margin-left:1px } .ml2 { margin-left:2px } .ml3 { margin-left:3px } .ml4 { margin-left:4px } .ml5 { margin-left:5px } .ml6 { margin-left:6px } .ml7 { margin-left:7px } .ml8 { margin-left:8px } .ml9 { margin-left:9px } .ml10 { margin-left:10px } .ml15 { margin-left:15px } .ml20 { margin-left:20px } .ml25 { margin-left:25px } .ml30 { margin-left:30px } .ml35 { margin-left:35px } .ml40 { margin-left:40px } .ml45 { margin-left:45px } .ml50 { margin-left:50px }

                                .p0 { padding:0px } .p1 { padding:1px } .p2 { padding:2px } .p3 { padding:3px } .p4 { padding:4px } .p5 { padding:5px } .p6 { padding:6px } .p7 { padding:7px } .p8 { padding:8px } .p9 { padding:9px } .p10 { padding:10px } .p15 { padding:15px } .p20 { padding:20px } .p25 { padding:25px } .p30 { padding:30px } .p35 { padding:35px } .p40 { padding:40px } .p45 { padding:45px } .p50 { padding:50px }
                                .pt0 { padding-top:0px } .pt1 { padding-top:1px } .pt2 { padding-top:2px } .pt3 { padding-top:3px } .pt4 { padding-top:4px } .pt5 { padding-top:5px } .pt6 { padding-top:6px } .pt7 { padding-top:7px } .pt8 { padding-top:8px } .pt9 { padding-top:9px } .pt10 { padding-top:10px } .pt15 { padding-top:15px } .pt20 { padding-top:20px } .pt25 { padding-top:25px } .pt30 { padding-top:30px } .pt35 { padding-top:35px } .pt40 { padding-top:40px } .pt45 { padding-top:45px } .pt50 { padding-top:50px }
                                .pr0 { padding-right:0px } .pr1 { padding-right:1px } .pr2 { padding-right:2px } .pr3 { padding-right:3px } .pr4 { padding-right:4px } .pr5 { padding-right:5px } .pr6 { padding-right:6px } .pr7 { padding-right:7px } .pr8 { padding-right:8px } .pr9 { padding-right:9px } .pr10 { padding-right:10px } .pr15 { padding-right:15px } .pr20 { padding-right:20px } .pr25 { padding-right:25px } .pr30 { padding-right:30px } .pr35 { padding-right:35px } .pr40 { padding-right:40px } .pr45 { padding-right:45px } .pr50 { padding-right:50px }
                                .pb0 { padding-bottom:0px } .pb1 { padding-bottom:1px } .pb2 { padding-bottom:2px } .pb3 { padding-bottom:3px } .pb4 { padding-bottom:4px } .pb5 { padding-bottom:5px } .pb6 { padding-bottom:6px } .pb7 { padding-bottom:7px } .pb8 { padding-bottom:8px } .pb9 { padding-bottom:9px } .pb10 { padding-bottom:10px } .pb15 { padding-bottom:15px } .pb20 { padding-bottom:20px } .pb25 { padding-bottom:25px } .pb30 { padding-bottom:30px } .pb35 { padding-bottom:35px } .pb40 { padding-bottom:40px } .pb45 { padding-bottom:45px } .pb50 { padding-bottom:50px }
                                .pl0 { padding-left:0px } .pl1 { padding-left:1px } .pl2 { padding-left:2px } .pl3 { padding-left:3px } .pl4 { padding-left:4px } .pl5 { padding-left:5px } .pl6 { padding-left:6px } .pl7 { padding-left:7px } .pl8 { padding-left:8px } .pl9 { padding-left:9px } .pl10 { padding-left:10px } .pl15 { padding-left:15px } .pl20 { padding-left:20px } .pl25 { padding-left:25px } .pl30 { padding-left:30px } .pl35 { padding-left:35px } .pl40 { padding-left:40px } .pl45 { padding-left:45px } .pl50 { padding-left:50px }

                                .clear { clear: both; } .clearl { clear: left; } .clearr { clear: right; }
                                .fr {float:right} .fl {float:left} .flnone {float:none}
                                .fl50 { float:left; width: calc(50% - 10px); } .fr50 { float:right; width: calc(50% - 10px) }
                                .fl45 { float:left; width: calc(45% - 10px); } .fr55 { float:right; width: calc(55% - 10px) }

                                .textaligncenter { text-align: center; } .textalignleft { text-align: left; } .textalignright { text-align: right; }

                                .fs8px {font-size:8px!important;} .fs9px {font-size:9px!important;} .fs10px {font-size:10px!important;} .fs11px {font-size:11px!important;} .fs12px {font-size:12px!important;} .fs13px {font-size:13px!important;} .fs14px {font-size:14px!important;} .fs15px {font-size:15px!important;} .fs16px {font-size:16px!important;} .fs17px {font-size:17px!important;} .fs18px {font-size:18px!important;} .fs19px {font-size:19px!important;} .fs20px {font-size:20px!important;}
                                .fspoint1em { font-size:.1em!important; } .fspoint2em { font-size:.2em!important; } .fspoint3em { font-size:.3em!important; } .fspoint4em { font-size:.4em!important; } .fspoint5em { font-size:.5em!important; } .fspoint6em { font-size:.6em!important; } .fspoint7em { font-size:.7em!important; } .fspoint8em { font-size:.8em!important; } .fspoint9em { font-size:.9em!important; }
                                .fs1em { font-size:1em!important; } .fs11em { font-size:1.1em!important; } .fs12em { font-size:1.2em!important; } .fs13em { font-size:1.3em!important; } .fs14em { font-size:1.4em!important; } .fs15em { font-size:1.5em!important; } .fs16em { font-size:1.6em!important; } .fs17em { font-size:1.7em!important; } .fs18em { font-size:1.8em!important; } .fs19em { font-size:1.9em!important; } .fs2em { font-size:2em!important; }
                                .fw100 {font-weight:100} .fw200 {font-weight:200} .fw300 {font-weight:300} .fw400 {font-weight:400} .fw500 {font-weight:500} .fw600 {font-weight:600} .fw700 {font-weight:700} .fw800 {font-weight:800} .fw900 {font-weight:900}
                                .fontstyleitalic {font-style:italic!important;} .fontstylenormal {font-style:normal!important;}

                                .ttuppercase { text-transform: uppercase; } .ttn { text-transform:none; }

                                .displayblock {display:block} .displayinlineblock {display:inline-block} .displaynone {display:none} .displayFlex {display: flex}

                                .w10pc { width:10%!important; } .w20pc { width:20%!important; } .w30pc { width:30%!important; } .w40pc { width:40%!important; } .w50pc { width:50%!important; } .w60pc { width:60%!important; } .w70pc { width:70%!important; } .w80pc { width:80%!important; } .w90pc { width:90%!important; } .w100pc { width:100%!important; }
                                .minw0 { min-width:0px!important; } .minw1 { min-width:1px!important; } .minw2 { min-width:2px!important; } .minw3 { min-width:3px!important; } .minw4 { min-width:4px!important; } .minw5 { min-width:5px!important; } .minw6 { min-width:6px!important; } .minw7 { min-width:7px!important; } .minw8 { min-width:8px!important; } .minw9 { min-width:9px!important; } .minw10 { min-width:10px!important; } .minw15 { min-width:15px!important; } .minw20 { min-width:20px!important; } .minw25 { min-width:25px!important; } .minw30 { min-width:30px!important; } .minw35 { min-width:35px!important; } .minw40 { min-width:40px!important; } .minw45 { min-width:45px!important; } .minw50 { min-width:50px!important; } .minw55 { min-width:55px!important; } .minw60 { min-width:60px!important; } .minw65 { min-width:65px!important; } .minw70 { min-width:70px!important; } .minw75 { min-width:75px!important; } .minw80 { min-width:80px!important; } .minw85 { min-width:85px!important; } .minw90 { min-width:90px!important; } .minw95 { min-width:95px!important; } .minw100 { min-width:100px!important; }
                                .mw0 { max-width:0px!important; } .mw1 { max-width:1px!important; } .mw2 { max-width:2px!important; } .mw3 { max-width:3px!important; } .mw4 { max-width:4px!important; } .mw5 { max-width:5px!important; } .mw6 { max-width:6px!important; } .mw7 { max-width:7px!important; } .mw8 { max-width:8px!important; } .mw9 { max-width:9px!important; } .mw10 { max-width:10px!important; } .mw15 { max-width:15px!important; } .mw20 { max-width:20px!important; } .mw25 { max-width:25px!important; } .mw30 { max-width:30px!important; } .mw35 { max-width:35px!important; } .mw40 { max-width:40px!important; } .mw45 { max-width:45px!important; } .mw50 { max-width:50px!important; } .mw55 { max-width:55px!important; } .mw60 { max-width:60px!important; } .mw65 { max-width:65px!important; } .mw70 { max-width:70px!important; } .mw75 { max-width:75px!important; } .mw80 { max-width:80px!important; } .mw85 { max-width:85px!important; } .mw90 { max-width:90px!important; } .mw95 { max-width:95px!important; } .mw100 { max-width:100px!important; }
                                .mh0 { max-height:0px!important; } .mh1 { max-height:1px!important; } .mh2 { max-height:2px!important; } .mh3 { max-height:3px!important; } .mh4 { max-height:4px!important; } .mh5 { max-height:5px!important; } .mh6 { max-height:6px!important; } .mh7 { max-height:7px!important; } .mh8 { max-height:8px!important; } .mh9 { max-height:9px!important; } .mh10 { max-height:10px!important; } .mh15 { max-height:15px!important; } .mh20 { max-height:20px!important; } .mh25 { max-height:25px!important; } .mh30 { max-height:30px!important; } .mh35 { max-height:35px!important; } .mh40 { max-height:40px!important; } .mh45 { max-height:45px!important; } .mh50 { max-height:50px!important; } .mh55 { max-height:55px!important; } .mh60 { max-height:60px!important; } .mh65 { max-height:65px!important; } .mh70 { max-height:70px!important; } .mh75 { max-height:75px!important; } .mh80 { max-height:80px!important; } .mh85 { max-height:85px!important; } .mh90 { max-height:90px!important; } .mh95 { max-height:95px!important; } .mh100 { max-height:100px!important; }

                                .b0 { border:0!important; } .bt0 {border-top:0!important;} .br0 {border-right:0!important;} .bb0 {border-bottom:0!important;} .bl0 {border-left:0!important;}
                                .borderSolid { border-style: solid; } .borderDashed { border-style: dashed; } .borderDotted { border-style: dotted; }
                                .borderW1px { border-width: 1px; } .borderW2px { border-width: 2px; } .borderW3px { border-width: 3px; } .borderW4px { border-width: 4px; } .borderW5px { border-width: 5px; }
                                .borderColorBlack { border-color: #000 } .borderColorGrey { border-color: #ddd } .borderColorDarkBlue { border-color: #101079!important }

                                .black {color:#000000!important; }
                                .darkRed { color:#a00000!important; }
                                .darkGreen { color:#41671e!important; }
                                .darkBlue { color:#101079!important; }

                                .bgColor_f5f5f5 {background-color:#f5f5f5;}
                                .bgColor_eeeeee {background-color:#eeeeee;}
                                .bgColor_dddddd {background-color:#dddddd;}
                                .bgColor_cccccc {background-color:#cccccc;}

                                /* ----------------------------------------------------------------------------- */

                                .documentType { width:calc(100% - 50mm) }
                                .documentDate { width:50mm; }

                                pre { white-space: pre-wrap; word-wrap: break-word; }

                                .resultLines {}
                                .resultHeader {}
                                .resultHeader div, .singleLineResult div {display:inline-block;}
                                .singleLineResult {}
                                .singleLineResult.outOfRange { color:#a00000; font-weight:700; }
                                .resultsLabel { width:60mm; vertical-align: top; }
                                .resultsValue { width:75mm; vertical-align: top; }
                                .resultsNormalValue { width:50mm; text-align:center; vertical-align: top; }
                                .resultsAuthor { width:30mm; vertical-align: top; }
                                .resultsDate { width:15mm; text-align:center; vertical-align: top; }

                                .imageContainer img {max-width:100%; height:auto;}

                                .schema {
                                    padding: 12px;
                                    width: auto;
                                    box-sizing: border-box;
                                }

                                .schemaLine {
                                    display: flex;
                                }

                                .schemaColumn {
                                    border: 1px solid #bababa;
                                }

                                .header {
                                    height: 31px;
                                    text-align: center;
                                    font-weight: bold;
                                }

                                .pad {
                                    padding: 5px;
                                }

                                .row {
                                    height: 80px;
                                }

                                .w00 {
                                    width: 260px;
                                }

                                .w11 {
                                    width: 88px;
                                }

                                .w44 {
                                    width: 358px;
                                }

                                .w55 {
                                    width: 448px;
                                }

                                .no-border{
                                    border: 1px solid transparent;
                                }

                                .group1 {
                                    background-color: #f3b738;
                                    color: white;
                                }

                                .group2 {
                                    background-color: #aebf41;
                                    color: white;
                                }

                                .product {
                                    padding: 5px;
                                    font-weight: bold;
                                    font-size: x-small;
                                    text-align: center;
                                }

                                .period {
                                    display: flex;
                                    flex-flow: column nowrap;
                                    padding: 5px;
                                    font-size: x-small;
                                    text-align: center;
                                }

                            </style>
                        </head>

                        <body>
                            <div class="page">` + body + `
                            </div>` +
                            '<script>document.fonts.ready.then(() => { setInterval(() => {document.body.dispatchEvent(new CustomEvent("pdfDoneRenderingEvent"))}, 500); }); <'+'/script>' + `
                        </body>
                    </html>
                `
            }
        }
        customElements.define(HtPatVaccineShemaDialog.is, HtPatVaccineShemaDialog);
    </script>
</dom-module>

