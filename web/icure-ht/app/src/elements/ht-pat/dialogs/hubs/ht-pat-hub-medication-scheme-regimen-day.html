<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../styles/shared-styles.html">
<link rel="import" href="../../../../styles/buttons-style.html">

<dom-module id="ht-pat-hub-medication-scheme-regimen-day">
    <template>
        <style include="buttons-style dropdown-style dialog-style">
            .grid-container * {
                border: 0;
                position: relative;
                display: flex;
                justify-content: center;
                align-items: center;
                font-size: var(--font-size-small);
                color: white;
                background: var(--app-background-color-dark);
            }

            .grid-container *:after {
                position: absolute;
                top: 0;
                left: 0;
            }

            .grid-container {
                /*width: 100%;*/
                width: 600px; /* temp */
                /*min-width: 0;*/
                height: 28px;
                /*min-height: 0;*/
                margin: 1px;
                grid-gap: 1px;
                display: grid;
                grid-template-columns: minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr) minmax(0, 1fr);
                grid-template-rows: 1fr 1fr;
                grid-template-areas: "a_a a_bcd a_bcd a_bcd a_e a_fgh a_fgh a_fgh a_i a_jkl a_jkl a_jkl a_m ab_n" ". b_b b_c b_d . b_f b_g b_h . b_j b_k b_l . ab_n";
            }

            .a_a {
                grid-area: a_a;
                border-radius: 8px 0 0 8px;
            }
            .a_bcd {
                grid-area: a_bcd;
            }
            .a_e {
                grid-area: a_e;
            }
            .a_fgh {
                grid-area: a_fgh;
            }
            .a_i {
                grid-area: a_i;
            }
            .a_jkl {
                grid-area: a_jkl;
            }
            .a_m {
                grid-area: a_m;
            }
            .ab_n {
                grid-area: ab_n;
                border-radius: 0 8px 8px 8px;
            }
            .b_b {
                grid-area: b_b;
                border-radius: 0 0 0 8px;
            }
            .b_c {
                grid-area: b_c;
            }
            .b_d {
                grid-area: b_d;
                border-radius: 0 0 8px 0;
            }
            .b_f {
                grid-area: b_f;
                border-radius: 0 0 0 8px;
            }
            .b_g {
                grid-area: b_g;
            }
            .b_h {
                grid-area: b_h;
                border-radius: 0 0 8px 0;
            }
            .b_j {
                grid-area: b_j;
                border-radius: 0 0 0 8px;
            }
            .b_k {
                grid-area: b_k;
            }
            .b_l {
                grid-area: b_l;
                border-radius: 0 0 8px 0;
            }

            div > div {
                overflow: hidden;
                min-height: 0;
                min-width: 0;
            }

            .hasQuantity {
                background: var(--app-secondary-color-dark);
            }

        </style>
        <div class="grid-container">
            <div class$="a_a [[getColor(quantities.afterwakingup)]]">[[quantities.afterwakingup]]</div>
            <div class$="a_bcd [[getColor(quantities.morning)]]">[[quantities.morning]]</div>
            <div class$="a_e [[getColor(quantities.betweenbreakfastandlunch)]]">[[quantities.betweenbreakfastandlunch]]</div>
            <div class$="a_fgh [[getColor(quantities.midday)]]">[[quantities.midday]]</div>
            <div class$="a_i [[getColor(quantities.betweenlunchanddinner)]]">[[quantities.betweenlunchanddinner]]</div>
            <div class$="a_jkl [[getColor(quantities.evening)]]">[[quantities.evening]]</div>
            <div class$="a_m [[getColor(quantities.thehourofsleep)]]">[[quantities.thehourofsleep]]</div>
            <div class$="ab_n [[getColor(quantities.other)]]">[[quantities.other]]</div>
            <div class$="b_b [[getColor(quantities.beforebreakfast)]]">[[quantities.beforebreakfast]]</div>
            <div class$="b_c [[getColor(quantities.duringbreakfast)]]">[[quantities.duringbreakfast]]</div>
            <div class$="b_d [[getColor(quantities.afterbreakfast)]]">[[quantities.afterbreakfast]]</div>
            <div class$="b_f [[getColor(quantities.beforelunch)]]">[[quantities.beforelunch]]</div>
            <div class$="b_g [[getColor(quantities.duringlunch)]]">[[quantities.duringlunch]]</div>
            <div class$="b_h [[getColor(quantities.afterlunch)]]">[[quantities.afterlunch]]</div>
            <div class$="b_j [[getColor(quantities.beforedinner)]]">[[quantities.beforedinner]]</div>
            <div class$="b_k [[getColor(quantities.duringdinner)]]">[[quantities.duringdinner]]</div>
            <div class$="b_l [[getColor(quantities.afterdinner)]]">[[quantities.afterdinner]]</div>
        </div>
   </template>
    <script>
        import _ from 'lodash/lodash'

        class HtPatHubMedicationSchemeRegimenDay extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-pat-hub-medication-scheme-regimen-day';
            }
            static get properties() {
                return {
                    api: {
                        type: Object
                    },
                    regimen: {
                        type: Object,
                        value: () => {}
                    },
                    quantities: {
                        type: Object,
                        value: () => {}
                    }
                }
            }
            static get observers() {
                return [
                    "_init(regimen.*)"
                ];
            }

            constructor() {
                super();
            }

            ready() {
                super.ready();
            }

            getColor(period) {
                return (period && period > 0) ? "hasQuantity" : "";
            }

            _init() {
                if (!this.regimen) return;
                this.set("quantities", this.regimen.reduce((quantities, reg) => {
                    if (reg.dayPeriod) {
                        quantities[reg.dayPeriod] = _.get(quantities, reg.dayPeriod, 0) + reg.quantity;
                    } else if (reg.dayTime) {
                        quantities['other'] = _.get(quantities, 'other', 0) + reg.quantity;
                    }
                    return quantities;
                }, {}));
            }
        }

        customElements.define(HtPatHubMedicationSchemeRegimenDay.is, HtPatHubMedicationSchemeRegimenDay);
    </script>
</dom-module>
