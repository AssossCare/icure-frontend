<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-text-field.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../../../../bower_components/vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../../../../../bower_components/vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../../bower_components/paper-styles/shadow.html">
<link rel="import" href="../../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../dynamic-form/dynamic-link.html">
<link rel="import" href="../../../dynamic-form/dynamic-pills.html">
<link rel="import" href="../../../ht-spinner/ht-spinner.html">
<link rel="import" href="../../../dynamic-form/dynamic-doc.html">
<link rel="import" href="../../../collapse-button/collapse-button.html">
<link rel="import" href="../../../../styles/dialog-style.html">
<link rel="import" href="../../../../styles/scrollbar-style.html">
<link rel="import" href="../../../../styles/buttons-style.html">
<link rel="import" href="../../../../styles/paper-tabs-style.html">
<link rel="import" href="../../../dynamic-form/dynamic-text-field.html">
<link rel="import" href="../../../../styles/notification-style.html">



<dom-module id="ht-pat-member-data-response">
    <template>
        <style include="dialog-style scrollbar-style buttons-style paper-tabs-style notification-style">
            #mdaDetailDialog{
                height: calc(98% - 12vh);
                width: 98%;
                max-height: calc(100% - 64px - 48px - 20px); /* 100% - header - margin - footer*/
                min-height: 400px;
                min-width: 800px;
                top: 64px;
            }

            .mdaDetailDialog{
                display: flex;
                height: calc(100% - 45px);;
                width: auto;
                margin: 0;
                padding: 0;
            }

            .mda-content{
                display: flex;
                width: 100%;
                position: relative;
                height: 100%;
                background-color: white;
            }

            .mda-menu-list{
                width: 30%;
            }

            .mda-view{
                width: 70%;
            }

            .mda-menu-list-header{
                height: 48px;
                width: 100%;
                border-bottom: 1px solid var(--app-background-color-darker);
                background-color: var(--app-background-color-dark);
                padding: 0 12px;
                display: flex;
                flex-flow: row wrap;
                justify-content: flex-start;
                align-items: center;
                box-sizing: border-box;
            }

            .mda-menu-list-header-info{
                margin-left: 12px;
                display: flex;
                align-items: center;
            }

            .mda-name{
                font-size: var(--font-size-large);
                font-weight: 700;
            }

            .mda-menu-search-line{
                display: flex;
            }

            .w100{
                width: 100%;
            }


            .w33{
                width: 33%;
            }

            .p4{
                padding: 4px;
            }

            .mtm2{
                margin-top: -2px;
            }

            .w40{
                width: 40%;
            }

            .headerInfoLine{
                width: 100%;
                padding: 4px;
                display: flex;
                flex-flow: row wrap;
                justify-content: flex-start;
                align-items: flex-start;
            }

            .headerInfoField{
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                align-content: stretch;
                width: calc(100% / 4);
                padding: 0 8px;
                box-sizing: border-box;
            }

            .headerLabel{
                font-weight: bold;
            }

            .mda-result-container{
                margin-bottom: 12px;
                border: 1px solid var(--app-background-color-dark);
            }

            .headerMasterTitle{
                font-size: var(--font-size-large);
                background: var(--app-background-color-dark);
                padding: 0 12px;
                box-sizing: border-box;
            }

            .mda-sub-container{
                height: auto;
                width: auto;
                margin: 10px;
                border: 1px solid var(--app-background-color-dark);
            }

            .mda-person-container{
                height: auto;
                width: auto;
            }

            .mda-address-container{
                height: auto;
                width: auto;
            }

            .mda-partnerInfo-container{
                height: auto;
                width: auto;
            }

            .mda-error-container{
                height: auto;
                width: auto;
                color: var(--app-status-color-nok);
                font-weight: bold;
            }

            .m5{
                margin: 5px;
            }


        </style>

        <div>
            <div class="mda-result-container m5">
                <div class="headerMasterTitle headerLabel h25">[[selectedPersonData.personData.name.first]] [[selectedPersonData.personData.name.last]] - [[selectedPersonData.ssin.value]]</div>
                <div class="mda-sub-container">
                    <template is="dom-repeat" items="[[mdaResult.assertions]]" as="assert">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[_getAssertionType(assert.advice.assertionType)]]</div>
                            <template is="dom-repeat" items="[[assert.statementsAndAuthnStatementsAndAuthzDecisionStatements]]" as="statement">
                                <template is="dom-repeat" items="[[statement.attributesAndEncryptedAttributes]]" as="attribute">
                                    <div class="headerInfoLine">
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[_getAttributeName(attribute)]]:</span> [[_getAttributeValue(attribute)]]
                                        </div>
                                    </div>
                                </template>
                            </template>
                        </div>
                    </template>
                </div>
            </div>
        </div>
    </template>
    <script>
        import moment from 'moment/src/moment';

        class HtPatMemberDataResponse extends Polymer.TkLocalizerMixin(Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element)) {
            static get is() {
                return 'ht-pat-member-data-response';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    patient:{
                        type: Object,
                        value: () => {}
                    },
                    hcp:{
                        type: Object,
                        value: () => {}
                    },
                    mdaSearch:{
                        type: Object,
                        value: () => {}
                    },
                    selectedMdaContactType:{
                        type: Object,
                        value: () => {}
                    },
                    selectedMdaRequestType:{
                        type: Object,
                        value: () => {}
                    },
                    mdaResult:{
                        type: Object,
                        value: () => {}
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }

            _getAssertionType(assertionType){
                return assertionType === "urn:be:cin:nippin:insurability:patientData" ? this.localize('mda-ass-patient-data', 'Patient data', this.language) :
                    assertionType === "urn:be:cin:nippin:insurability:period" ? this.localize('mda-ass-period', 'Period', this.language) :
                        assertionType === "urn:be:cin:nippin:insurability:payment" ? this.localize('mda-ass-payment', 'Payment', this.language) :
                            assertionType === "urn:be:cin:nippin:medicalHouse" ? this.localize('mda-mmh', 'Medical house', this.language) :
                                assertionType === "urn:be:cin:nippin:hospitalisation" ? this.localize('mda-hospi', 'Hospitalisation', this.language) :
                                    assertionType === "urn:be:cin:nippin:insurability:generalSituation" ? this.localize('mda-general-situation', 'General situation', this.language) :
                                        assertionType === "urn:be:cin:nippin:carePath" ? this.localize('mda-care-path', 'Care path', this.language) :
                                            assertionType === "urn:be:cin:nippin:chronicCondition" ? this.localize('mda-chronic-condition', 'Chronic condition', this.language) :
                                                assertionType === "urn:be:cin:nippin:referencePharmacy" ? this.localize('mda-ref-pharmacy', 'Reference pharmacy', this.language) :
                                                    assertionType
            }

            _getStatusOfRequest(statusCode){
                return statusCode === "urn:oasis:name:tc:SAML:2.0:status:Success" ? this.localize('mda-stat-succ', 'Succcess', this.language) :
                    statusCode === "urn:oasis:name:tc:SAML:2.0:status:Requester" ? this.localize('mda-stat-requ', 'Requester', this.language) :
                        statusCode === "urn:oasis:name:tc:SAML:2.0:status:Responder" ? this.localize('mda-stat-resp', 'Responder', this.language) :
                            statusCode === "urn:be:cin:nippin:SAML:status:PartialAnswer" ? this.localize('mda-stat-part-ans', 'Partial answer', this.language) :
                                statusCode
            }

            _getAttributeName(att){
                return _.get(att, 'name', null)
            }

            _getAttributeValue(att){
                return _.get(att, 'attributeValues', []).join(" ")
            }

        }
        customElements.define(HtPatMemberDataResponse.is, HtPatMemberDataResponse);
    </script>
</dom-module>
