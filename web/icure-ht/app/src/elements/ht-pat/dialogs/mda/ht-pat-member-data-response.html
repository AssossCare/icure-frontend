<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-text-field.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../../../../bower_components/vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../../../../../bower_components/vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../../bower_components/paper-styles/shadow.html">
<link rel="import" href="../../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../dynamic-form/dynamic-link.html">
<link rel="import" href="../../../dynamic-form/dynamic-pills.html">
<link rel="import" href="../../../ht-spinner/ht-spinner.html">
<link rel="import" href="../../../dynamic-form/dynamic-doc.html">
<link rel="import" href="../../../collapse-button/collapse-button.html">
<link rel="import" href="../../../../styles/dialog-style.html">
<link rel="import" href="../../../../styles/scrollbar-style.html">
<link rel="import" href="../../../../styles/buttons-style.html">
<link rel="import" href="../../../../styles/paper-tabs-style.html">
<link rel="import" href="../../../dynamic-form/dynamic-text-field.html">
<link rel="import" href="../../../../styles/notification-style.html">



<dom-module id="ht-pat-member-data-response">
    <template>
        <style include="dialog-style scrollbar-style buttons-style paper-tabs-style notification-style">
            #mdaDetailDialog{
                height: calc(98% - 12vh);
                width: 98%;
                max-height: calc(100% - 64px - 48px - 20px); /* 100% - header - margin - footer*/
                min-height: 400px;
                min-width: 800px;
                top: 64px;
            }

            .mdaDetailDialog{
                display: flex;
                height: calc(100% - 45px);;
                width: auto;
                margin: 0;
                padding: 0;
            }

            .mda-content{
                display: flex;
                width: 100%;
                position: relative;
                height: 100%;
                background-color: white;
            }

            .mda-menu-list{
                width: 30%;
            }

            .mda-view{
                width: 70%;
            }

            .mda-menu-list-header{
                height: 48px;
                width: 100%;
                border-bottom: 1px solid var(--app-background-color-darker);
                background-color: var(--app-background-color-dark);
                padding: 0 12px;
                display: flex;
                flex-flow: row wrap;
                justify-content: flex-start;
                align-items: center;
                box-sizing: border-box;
            }

            .mda-menu-list-header-info{
                margin-left: 12px;
                display: flex;
                align-items: center;
            }

            .mda-name{
                font-size: var(--font-size-large);
                font-weight: 700;
            }

            .mda-menu-search-line{
                display: flex;
            }

            .w100{
                width: 100%;
            }


            .w33{
                width: 33%;
            }

            .p4{
                padding: 4px;
            }

            .mtm2{
                margin-top: -2px;
            }

            .w40{
                width: 40%;
            }

            .headerInfoLine{
                width: 100%;
                padding: 4px;
                display: flex;
                flex-flow: row wrap;
                justify-content: flex-start;
                align-items: flex-start;
            }

            .headerInfoField{
                display: flex;
                flex-direction: row;
                flex-wrap: wrap;
                align-items: center;
                align-content: stretch;
                width: calc(100% / 4);
                padding: 0 8px;
                box-sizing: border-box;
            }

            .headerLabel{
                font-weight: bold;
            }

            .mda-result-container{
                margin-bottom: 12px;
                border: 1px solid var(--app-background-color-dark);
            }

            .headerMasterTitle{
                font-size: var(--font-size-large);
                background: var(--app-background-color-dark);
                padding: 0 12px;
                box-sizing: border-box;
            }

            .mda-sub-container{
                height: auto;
                width: auto;
                margin: 10px;
                border: 1px solid var(--app-background-color-dark);
            }

            .mda-person-container{
                height: auto;
                width: auto;
            }

            .mda-address-container{
                height: auto;
                width: auto;
            }

            .mda-partnerInfo-container{
                height: auto;
                width: auto;
            }

            .mda-error-container{
                height: auto;
                width: auto;
                color: var(--app-status-color-nok);
                font-weight: bold;
            }

            .m5{
                margin: 5px;
            }


        </style>

        <div>
            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:insurability:patientData', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.patientData]]" as="pd">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Patient data', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-name', 'Name', language)]]: </span> [[pd.careReceiver.name]]
                                </div>
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-firstName', 'First name', language)]]: </span> [[pd.careReceiver.firstName]]
                                </div>
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-gender', 'Gender', language)]]: </span> [[pd.careReceiver.gender]]
                                </div>
                            </div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-name', 'Niss', language)]]: </span> [[pd.person.ssin]]
                                </div>
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-birdthDate', 'Birth date', language)]]: </span> [[pd.careReceiver.birthDate]]
                                </div>
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-deceasedDate', 'Deceased date', language)]]: </span> [[pd.careReceiver.deceasedDate]]
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:insurability:period', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.period]]" as="p">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Period', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-reg-numb', 'Registration number', language)]]: </span> [[p.careReceiver.registrationNumber]]
                                </div>
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-mut', 'Mutuality', language)]]: </span> [[p.careReceiver.mutuality]]
                                </div>
                            </div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-ct-code', 'Ct code', language)]]: </span> [[p.cb1]]/[[p.cb2]]
                                </div>
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-com-date', 'Communication date', language)]]: </span> [[p.communicationDate]]
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:insurability:payment', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.payment]]" as="p">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Payment', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-payment-io', 'Payment by IO', language)]]: </span> [[p.paymentByIO]]
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:medicalHouse', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.medicalHouse]]" as="mmh">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Medical house', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoLine">
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-nihii', 'Nihii', language)]]: </span> [[mmh.medicalHouse.nihii]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-name', 'Name', language)]]: </span> [[mmh.medicalHouse.name]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-type', 'Type', language)]]: </span> [[mmh.medicalHouse.type]]
                                    </div>
                                </div>
                                <div class="headerInfoLine">
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-startDate', 'Start date', language)]]: </span> [[mmh.medicalHouse.startDate]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-endDate', 'End date', language)]]: </span> [[mmh.medicalHouse.startDate]]
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:hospitalisation', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.hospitalisation]]" as="hosp">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Hospitalisation', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoLine">
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-nihii', 'Nihii', language)]]: </span> [[hosp.hospitalisation.hospital:nihii]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-name', 'Name', language)]]: </span> [[hosp.hospitalisation.hospital:name]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-service', 'Service', language)]]: </span> [[hosp.hospitalisation.service]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-adm-date', 'Admission date', language)]]: </span> [[hosp.hospitalisation.admissionDate]]
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="_isDataAvailable('urn:be:cin:nippin:generalSituation', mdaResult, mdaResult.*)">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.generalSituation]]" as="gs">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'General situation', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoLine">
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-event', 'Event', language)]]: </span> [[gs.generalSituation.event]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-direction', 'Direction', language)]]: </span> [[gs.generalSituation.transfert:direction]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-io', 'IO', language)]]: </span> [[gs.generalSituation.transfert:IO]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-date', 'Transfert date', language)]]: </span> [[gs.generalSituation.transfert:transfertDate]]
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:carePath', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.carePath]]" as="cp">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Care path', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-type', 'Type', language)]]:  </span> [[cp.carePath.type]]
                                </div>
                                <div class="headerInfoLine">
                                    <div class="headerInfoLine">
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[localize('mda-nihii', 'Nihii', language)]]: </span> [[cp.carePath.physician.nihii]]
                                        </div>
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[localize('mda-firstName', 'First name', language)]]: </span> [[cp.carePath.physician.firstName]]
                                        </div>
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[localize('mda-lastName', 'Last name', language)]]: </span> [[cp.carePath.physician.lastName]]
                                        </div>
                                    </div>
                                </div>
                                <div class="headerInfoLine">
                                    <div class="headerInfoLine">
                                        <div class="headerInfoLine">
                                            <div class="headerInfoField">
                                                <span class="headerLabel">[[localize('mda-nihii', 'Nihii', language)]]: </span> [[cp.carePath.medicalHouse.nihii]]
                                            </div>
                                            <div class="headerInfoField">
                                                <span class="headerLabel">[[localize('mda-name', 'Name', language)]]: </span> [[cp.carePath.medicalHouse.name]]
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="headerInfoLine">
                                    <div class="headerInfoLine">
                                        <div class="headerInfoLine">
                                            <div class="headerInfoField">
                                                <span class="headerLabel">[[localize('mda-nihii', 'Nihii', language)]]: </span> [[cp.carePath.specialist.nihii]]
                                            </div>
                                            <div class="headerInfoField">
                                                <span class="headerLabel">[[localize('mda-firstName', 'First name', language)]]: </span> [[cp.carePath.specialist.firstName]]
                                            </div>
                                            <div class="headerInfoField">
                                                <span class="headerLabel">[[localize('mda-lastName', 'Last name', language)]]: </span> [[cp.carePath.specialist.lastName]]
                                            </div>
                                            <div class="headerInfoField">
                                                <span class="headerLabel">[[localize('mda-speciality', 'Speciality', language)]]: </span> [[cp.carePath.specialist.speciality]]
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="headerInfoLine">
                                    <div class="headerInfoLine">
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[localize('mda-startRightDate', 'Start right date', language)]]: </span> [[cp.carePath.startRightDate]]
                                        </div>
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[localize('mda-endContractDate', 'End contract date', language)]]: </span> [[cp.carePath.endContractDate]]
                                        </div>
                                        <div class="headerInfoField">
                                            <span class="headerLabel">[[localize('mda-endRightDate', 'End right date', language)]]: </span> [[cp.carePath.endRightDate]]
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:chronicCondition', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.chronicCondition]]" as="cc">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Chronic condition', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoField">
                                    <span class="headerLabel">[[localize('mda-year', 'Year', language)]]: </span> [[cc.chronicCondition.year]]
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>

            <template is="dom-if" if="[[_isDataAvailable('urn:be:cin:nippin:referencePharmacy', mdaResult, mdaResult.*)]]">
                <template is="dom-repeat" items="[[mdaResult.formatResponse.chronicCondition]]" as="rp">
                    <div class="mda-sub-container">
                        <div class="mda-person-container">
                            <div class="headerMasterTitle headerLabel">[[localize('', 'Reference pharmacy', language)]]</div>
                            <div class="headerInfoLine">
                                <div class="headerInfoLine">
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-nihii', 'Nihii', language)]]: </span> [[rp.referencePharmacy.pharmacy.nihii]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-name', 'Name', language)]]: </span> [[rp.referencePharmacy.pharmacy.name]]
                                    </div>
                                    <div class="headerInfoField">
                                        <span class="headerLabel">[[localize('mda-startDate', 'Start date', language)]]: </span> [[rp.referencePharmacy.startDate]]
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </template>
            </template>
        </div>
    </template>
    <script>
        import moment from 'moment/src/moment';

        class HtPatMemberDataResponse extends Polymer.TkLocalizerMixin(Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element)) {
            static get is() {
                return 'ht-pat-member-data-response';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    patient:{
                        type: Object,
                        value: () => {}
                    },
                    hcp:{
                        type: Object,
                        value: () => {}
                    },
                    mdaSearch:{
                        type: Object,
                        value: () => {}
                    },
                    selectedMdaContactType:{
                        type: Object,
                        value: () => {}
                    },
                    selectedMdaRequestType:{
                        type: Object,
                        value: () => {}
                    },
                    mdaResult:{
                        type: Object,
                        value: () => {}
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }

            _getAssertionType(assertionType){
                return this.localize('mda-ass-'+_.last(_.split(assertionType, ':')), _.last(_.split(assertionType, ':')), this.language)
            }

            _getStatusOfRequest(statusCode){
                return this.localize('mda-stat-'+_.last(_.split(statusCode, ':')), _.last(_.split(statusCode, ':')), this.language)
            }

            _getAttributeName(att){
                return this.localize('mda-att-name-'+_.last(_.split(_.get(att, 'name', null), ':')), _.last(_.split(_.get(att, 'name', null), ':')), this.language)
            }

            _getAttributeValue(att){
                return _.get(att, 'attributeValues', []).join(" ")
            }

            _isDataAvailable(type, mdaResult){
                return !!_.get(mdaResult, 'assertions', []).find(assertion => _.get(assertion, 'advice.assertionType', null) === type)
            }

        }
        customElements.define(HtPatMemberDataResponse.is, HtPatMemberDataResponse);
    </script>
</dom-module>
