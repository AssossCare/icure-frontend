<link rel="import" href="../../../../../bower_components/polymer/polymer.html">
<link rel="import" href="../../../../../bower_components/vaadin-icons/vaadin-icons.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-text-field.html">
<link rel="import" href="../../../../../bower_components/vaadin-material-theme/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/vaadin-date-picker/vaadin-date-picker.html">
<link rel="import" href="../../../../../bower_components/vaadin-form-layout/vaadin-form-layout.html">
<link rel="import" href="../../../../../bower_components/vaadin-combo-box/vaadin-combo-box.html">
<link rel="import" href="../../../../../bower_components/vaadin-text-field/vaadin-text-area.html">
<link rel="import" href="../../../../../bower_components/vaadin-checkbox/vaadin-checkbox.html">
<link rel="import" href="../../../../../bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="../../../../../bower_components/paper-button/paper-button.html">
<link rel="import" href="../../../../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../../../../../bower_components/paper-styles/shadow.html">
<link rel="import" href="../../../../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">
<link rel="import" href="../../../dynamic-form/dynamic-link.html">
<link rel="import" href="../../../dynamic-form/dynamic-pills.html">
<link rel="import" href="../../../ht-spinner/ht-spinner.html">
<link rel="import" href="../../../dynamic-form/dynamic-doc.html">
<link rel="import" href="../../../collapse-button/collapse-button.html">
<link rel="import" href="../../../../styles/dialog-style.html">
<link rel="import" href="../../../../styles/scrollbar-style.html">
<link rel="import" href="../../../../styles/buttons-style.html">
<link rel="import" href="../../../../styles/paper-tabs-style.html">
<link rel="import" href="../../../dynamic-form/dynamic-text-field.html">
<link rel="import" href="../../../../styles/notification-style.html">

<link rel="import" href="./ht-pat-subscription-send-subscription.html">
<link rel="import" href="./ht-pat-subscription-cancel-subscription.html">
<link rel="import" href="./ht-pat-subscription-notify-subscription-closure.html">
<link rel="import" href="./ht-pat-subscription-technical-info.html">


<dom-module id="ht-pat-subscription-detail">
    <template>
        <style include="dialog-style scrollbar-style buttons-style paper-tabs-style notification-style">
            #subscriptionDetailDialog{
                height: calc(98% - 12vh);
                width: 98%;
                max-height: calc(100% - 64px - 48px - 20px); /* 100% - header - margin - footer*/
                min-height: 400px;
                min-width: 800px;
                top: 64px;
            }

            .subscriptionDetailDialog{
                display: flex;
                height: calc(100% - 45px);;
                width: auto;
                margin: 0;
                padding: 0;
            }

            .subscription-content{
                display: flex;
                width: 100%;
                position: relative;
                height: 100%;
                background-color: white;
            }

            .subscription-view{
                width: 100%;
                height: 100%;
                overflow: auto;
            }

            .page-content{
                padding: 12px;
                width: auto;
                box-sizing: border-box;
                height: calc(100% - 50px);
            }

            iron-pages{
                height: calc(100% - 48px);
                width: auto;
                overflow: auto;
            }

            #htPatSubscriptionSendSubscription{

            }

            #htPatSubscriptionCancelSubscription{

            }

            #htPatSubscriptionNotifySubscriptionClosure{

            }

            #htPatSubscriptionTechnicalInfo{

            }


        </style>

        <paper-dialog id="subscriptionDetailDialog">
            <div class="subscriptionDetailDialog">
                <div class="subscription-content">
                    <div class="subscription-view">
                        <paper-tabs selected="{{tabs}}">
                            <paper-tab>
                                <iron-icon class="tabIcon" icon="icons:note-add"></iron-icon> [[localize('mhm-send-subscription','Send subscription',language)]]
                            </paper-tab>
                            <paper-tab>
                                <iron-icon class="tabIcon" icon="icons:close"></iron-icon> [[localize('mhm-cancel-subscription','Cancel subscription',language)]]
                            </paper-tab>
                            <paper-tab>
                                <iron-icon class="tabIcon" icon="icons:last-page"></iron-icon> [[localize('mhm-notify-subscription-closure','Notify subscription closure',language)]]
                            </paper-tab>
                            <template is="dom-if" if="[[_isTechnicalInfo(subscriptionResult, subscriptionResult.*)]]">
                                <paper-tab>
                                    <iron-icon class="tabIcon" icon="vaadin:tools"></iron-icon> [[localize('mhm-technical-info','Technical info',language)]]
                                </paper-tab>
                            </template>
                        </paper-tabs>
                        <iron-pages selected="[[tabs]]">
                            <page>
                                <div class="page-content">
                                    <ht-pat-subscription-send-subscription id="htPatSubscriptionSendSubscription" api="[[api]]" i18n="[[i18n]]" user="[[user]]" patient="[[patient]]" language="[[language]]" resources="[[resources]]" current-contact="[[currentContact]]" hcp="[[hcp]]"></ht-pat-subscription-send-subscription>
                                </div>
                            </page>
                            <page>
                                <div class="page-content">
                                    <ht-pat-subscription-cancel-subscription id="htPatSubscriptionCancelSubscription" api="[[api]]" i18n="[[i18n]]" user="[[user]]" patient="[[patient]]" language="[[language]]" resources="[[resources]]" current-contact="[[currentContact]]" hcp="[[hcp]]"></ht-pat-subscription-cancel-subscription>
                                </div>
                            </page>
                            <page>
                                <div class="page-content">
                                    <ht-pat-subscription-notify-subscription-closure id="htPatSubscriptionNotifySubscriptionClosure" api="[[api]]" i18n="[[i18n]]" user="[[user]]" patient="[[patient]]" language="[[language]]" resources="[[resources]]" current-contact="[[currentContact]]" hcp="[[hcp]]"></ht-pat-subscription-notify-subscription-closure>
                                </div>
                            </page>
                            <page>
                                <div class="page-content">
                                    <ht-pat-subscription-technical-info id="htPatSubscriptionTechnicalInfo" api="[[api]]" i18n="[[i18n]]" user="[[user]]" patient="[[patient]]" language="[[language]]" resources="[[resources]]" hcp="[[hcp]]"></ht-pat-subscription-technical-info>
                                </div>
                            </page>
                        </iron-pages>
                    </div>
                </div>
                <div class="buttons">
                    <paper-button class="button button--other" on-tap="_closeDialog"><iron-icon icon="icons:close" class="mr5 smallIcon" ></iron-icon> [[localize('clo','Close',language)]]</paper-button>
                    <paper-button class="button button--save" on-tap="_sendSubscription"><iron-icon icon="icons:note-add" class="mr5 smallIcon" ></iron-icon> [[localize('mhm-send-subscription','Send subscription',language)]]</paper-button>
                    <paper-button class="button button--save" on-tap="_cancelSubscription"><iron-icon icon="icons:close" class="mr5 smallIcon" ></iron-icon> [[localize('mhm-cancel-subscription','Cancel subscription',language)]]</paper-button>
                    <paper-button class="button button--save" on-tap="_notifySubscriptionClosure"><iron-icon icon="icons:last-page" class="mr5 smallIcon" ></iron-icon> [[localize('mhm-notify-subscription-closure','Notify subscription closure',language)]]</paper-button>
                </div>
            </div>
        </paper-dialog>
    </template>
    <script>
        import moment from 'moment/src/moment';

        class HtPatSubscriptionDetail extends Polymer.TkLocalizerMixin(Polymer.mixinBehaviors([Polymer.IronResizableBehavior], Polymer.Element)) {
            static get is() {
                return 'ht-pat-subscription-detail';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    i18n:{
                        type: Object,
                        value: {}
                    },
                    resources:{
                        type: Object,
                        value: {}
                    },
                    language: {
                        type: String
                    },
                    patient:{
                        type: Object,
                        value: () => {}
                    },
                    hcp:{
                        type: Object,
                        value: () => {}
                    },
                    tabs:{
                        type: Number,
                        value: 0
                    },
                    isLoading:{
                        type: Boolean,
                        value: false
                    },
                    mdaResult:{
                        type: Object,
                        value: () => {}
                    }
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }


            _openDialog(){
                this.api.hcparty().getHealthcareParty(_.get(this.user, 'healthcarePartyId', null))
                    .then(hcp => this.set('hcp', hcp))
                    .finally(() => {
                        this.set('tabs', 0)
                        this.$['subscriptionDetailDialog'].open()
                    })
            }

            _isTechnicalInfo(){

            }

            _closeDialog(){
                this.$['subscriptionDetailDialog'].close()
            }

            _sendSubscription(){
                this.$['htPatSubscriptionSendSubscription']._sendSubscription()
            }

            _cancelSubscription(){
                this.$['htPatSubscriptionCancelSubscription']._cancelSubscription()
            }

            _notifySubscriptionClosure(){
                this.$['htPatSubscriptionNotifySubscriptionClosure']._notifySubscriptionClosure()
            }

        }
        customElements.define(HtPatSubscriptionDetail.is, HtPatSubscriptionDetail);
    </script>
</dom-module>
