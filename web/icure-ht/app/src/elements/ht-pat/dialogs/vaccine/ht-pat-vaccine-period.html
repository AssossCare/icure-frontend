<link rel="import" href="../../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../../../../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../../../../../bower_components/paper-icon-button/paper-icon-button.html">

<dom-module id="ht-pat-vaccine-period">
    <template>
        <style include="scrollbar-style dialog-style">
            .period{
                display: flex;
                flex-wrap: nowrap;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                align-self: center;
            }
            .period-status {
                display: flex;
                flex-direction: row;
                font-size: small;
            }
            .period-status paper-item.iron-selected {
                background: initial;
            }
            #menuButton {
                padding: 0px;
                margin: 0px;
            }
            #iconButton {
                padding: 0px;
                margin: 0px;
                height: 16px;
                width: 16px;
            }
        </style>

        <div class="period">
            <template is="dom-if" if="[[period.service]]">
                <div class="period-date">[[_dateFormat()]]</div>
                <div class="period-status">
                    <span>[[_status()]]</span>
                    <paper-menu-button id="menuButton">
                        <paper-icon-button id="iconButton" icon="paper-dropdown-menu:arrow-drop-down" slot="dropdown-trigger"></paper-icon-button>
                        <paper-listbox slot="dropdown-content">
                            <paper-item id="pending" on-tap="_toggleStatus">pending</paper-item>
                            <paper-item id="planned" on-tap="_toggleStatus">planned</paper-item>
                            <paper-item id="cancelled" on-tap="_toggleStatus">cancelled</paper-item>
                            <paper-item id="completed" on-tap="_toggleStatus">completed</paper-item>
                        </paper-listbox>
                    </paper-menu-button>
                </div>
                <div class="period-checked">
                    <paper-checkbox checked="[[_isChecked(period)]]" on-checked-changed="_checkedChanged"></paper-checkbox>
                </div>
            </template>
        </div>

    </template>
    <script>

        class HtPatVaccinePeriod extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-pat-vaccine-period';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    status: {
                        type: String
                    },
                    period: {
                        type: Object,
                        value: null
                    },
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }

            _status() {
                return this.period.service.tags.find(t => t.type == "CD-LIFECYCLE").code;
            }

            _setStatus(code) {
                this.period.service.tags.find(t => t.type == 'CD-LIFECYCLE').code = code;
                this.set("status", code);
            }

            _dateFormat() {
                return this.api.moment(this.period.service.valueDate).format('DD/MM/YYYY');
            }

            _isChecked() {
                return this.period.service.tags.some(t => t.type == 'CD-LIFECYCLE' && t.code == 'planned');
            }

            _checkedChanged() {
                this._setStatus(!this._isChecked() ? 'planned' : 'cancelled');
            }

            _toggleStatus(e) {
                console.log(e.currentTarget.id);
                //this._setStatus("pending");
            }
        }
        customElements.define(HtPatVaccinePeriod.is, HtPatVaccinePeriod);
    </script>
</dom-module>

