<link rel="import" href="../../../../../bower_components/polymer/polymer.html">

<link rel="import" href="../../../../../bower_components/paper-item/paper-item.html">
<link rel="import" href="../../../../../bower_components/paper-checkbox/paper-checkbox.html">

<dom-module id="ht-pat-vaccine-period">
    <template>
        <style include="scrollbar-style dialog-style">
            .period{
                display: flex;
                flex-wrap: nowrap;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                align-self: center;
            }
        </style>

        <div class="period">
            <template is="dom-if" if="[[period.service]]">
                <div class="period-date">[[_dateFormat()]]</div>
                <div class="period-status">[[period.code]]
                    <div>[[period.status]]</div>
                </div>
                <div class="period-checked">
                    <paper-checkbox checked="[[_isChecked(period)]]" on-checked-changed="_checkedChanged"></paper-checkbox>
                </div>
            </template>
        </div>

    </template>
    <script>

        class HtPatVaccinePeriod extends Polymer.TkLocalizerMixin(Polymer.Element) {
            static get is() {
                return 'ht-pat-vaccine-period';
            }

            static get properties() {
                return {
                    api: {
                        type: Object,
                        value: null
                    },
                    user: {
                        type: Object,
                        value: null
                    },
                    language: {
                        type: String
                    },
                    period: {
                        type: Object,
                        value: null
                    },
                };
            }

            static get observers() {
                return [];
            }

            ready() {
                super.ready();
            }

            _dateFormat() {
                return this.api.moment(this.period.service.valueDate).format('DD/MM/YYYY');
            }

            _isChecked() {
                return this.period.service.tags.some(t => t.type == 'CD-LIFECYCLE' && t.code == 'planned');
            }

            _checkedChanged() {
                const code = !this._isChecked() ? 'planned' : 'cancelled';
                this.period.service.tags.find(t => t.type == 'CD-LIFECYCLE').code = code;

            }
        }
        customElements.define(HtPatVaccinePeriod.is, HtPatVaccinePeriod);
    </script>
</dom-module>

